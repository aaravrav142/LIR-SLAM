function r = quat2rot(q)

  q_2 = q.^2; 

  % TODO: rotation is transposed?
  r = [ (1 - 2*(q_2(3) + q_2(4))),    2*(q(2)*q(3) + q(1)*q(4)),    2*(q(2)*q(4) - q(1)*q(3)); 
        2*(q(2)*q(3) - q(1)*q(4)),    (1 - 2*(q_2(2) + q_2(4))),    2*(q(3)*q(4) + q(1)*q(2)); 
        2*(q(2)*q(4) + q(1)*q(3)),    2*(q(3)*q(4) - q(1)*q(2)),    (1 - 2*(q_2(2) + q_2(3))) ]';

